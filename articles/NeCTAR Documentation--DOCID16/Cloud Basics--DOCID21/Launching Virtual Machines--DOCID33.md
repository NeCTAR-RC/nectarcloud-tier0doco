- [Creating an SSH Keypair](#Keypair)
- [Configuring an Instance](#Configuration)
- [Create a Security Group](#SecurityGroup)
- [Example - launching an instance](#Example)

This guide describes launching a running instance (virtual machine) with SSH login
enabled.

Setting up and using the Virtual Machines requires at least some familiarity with
UNIX shell (often called 'BASH') commands. There are many excellent beginner's 
tutorials to refresh your skills, such as this short, interactive tutorial from
[Codecademy][codecademy bash].

## Preparation - creating an SSH keypair <a name="Keypair"></a>

You need to create a public/private key pair before you can use SSH to login to 
the newly-created instance. The public key will be stored on the instance and
the private key is used on your desktop/laptop. 

1. Keys can be created on the Nectar dashboard, and the private key downloaded to your computer; or
1. Keys can be created by your computer, and the public key uploaded to Nectar.



## 1. Create Keys on the Nectar Cloud Dashboard

![`create_keypair`](images/create_keypair.png)

1. Login to the [Cloud Dashboard][dashboard]
1. Go to the Access and Security tab and then to the Keypairs page
1. Click the 'Create Key Pair' button
1. Type in a keypair name in the popup window and click the 'Create Key Pair'
 button. The private key will be downloaded to your local computer.
1. Save the private key into a directory on your local computer.

---

### Mac / Linux

`mv ~/Downloads/Nectar_Key.pem ~/.ssh/Nectar_Key` This moves the private key to 
the '.ssh' folder (change 'Nectar_Key' to the name of your keypair).

Note: For the security of your private key, you should ensure that only the user can read the file:
On you local computer, enter `chmod 600 ~/.ssh/Nectar_Key`. 

---

### Windows

Under Windows, the SSH private key will need to be converted to an OpenSSH key for use with PuTTY.

1. Open PuTTYgen
1. Click the 'Load' button to load the private key that was generated by the Cloud Dashboard
1. Click 'Export OpenSSH key' from 'Conversions' menu
1. Type a private key name and save

![`puttygen3`](images/puttygen3.png) 


## 2. Alternatively: Create a keypair locally

### Windows User

On Windows computers, the program PuTTY is used as an SSH client and a terminal emulator.
Putty allows the Windows user to access and use the VM via the command line.
Use the PuTTYgen key generator to generate the required key pair:

![`puttygen1`](images/puttygen1.png)

1. Download PuTTYgen (`puttygen.exe`) from [PuTTYgen download page][putty]
1. Launch the PuTTYgen application by double-clicking the `puttygen.exe`
1. The default settings are fine for this case; click the 'Generate' button
1. Save your public key by clicking the 'Save public key' button. You should give a
 name that will help identify the key in the future
1. Save your private key by clicking the 'Save private key' button. You should give
 a sensible name for future reference. The passphrase can provide additional
 security, though can be left empty.

---

### Linux/Mac User

On Mac and Linux computers, commands are entered directly in the 'Terminal' application.

`ssh-keygen -t rsa -f Nectar_Key`

1. To generate a keypair, enter the above command in the Terminal.
1. Instead of "Nectar_Key", enter your preferred key name.
1. By default, key files will be generated in the directory '~/.ssh'. Check with ```ls ~/.ssh```
1. You should see a private key (e.g. 'Nectar_Key') and a public key (e.g. 'Nectar_Key.pub')

Note: For the security of your private key, ensure that only the user can read the file:
On you local computer, enter `chmod 600 ~/.ssh/Nectar_Key`.

---

### Import the Public Key to Nectar

The public key generated by Windows/Linux/Mac needs to be imported into
the Nectar Cloud dashboard before it can be used.

![`keypair`](images/keypair.png)

![`key4`](images/key4.png) 

1. Log into the [Cloud Dashboard][dashboard]
1. Go to the 'Access and Security' tab and then to the 'Keypairs' page
1. Click the 'Import Key Pair' button
1. Type in a keypair name and paste the contents of the public key. 

- For **Windows** users, open PuTTYgen and click the 'Load' button to load the related private key and copy/paste the public key contents.
- For **Linux/Mac** user, type `cat ~/.ssh/id_rsa.pub` and copy/paste the public key contents from the terminal output.




---

For more information, you can access the detailed [SSH key tutorial page][SSH tutorial].

---


## Select an Image

You need to select an image to be used for your instance. The image defines what
operating system the instance uses and thus you need to select an image based on
your needs. Nectar Cloud offers a list of official images and for
simplicity, these images are recommended. You can find a complete list of
official images from [Nectar image catalog][image]. You can also find all
available images from the [Cloud Dashboard][dashboard].

- Login to the [Cloud Dashboard][dashboard]
- Go to the Dashboard 'Images' tab

For advanced users, you can also create your own images. Please refer to
the [openstack documentation][openstack image] for more details.

## Configure Instance <a name="Configuration"></a>

Before you can launch an instance, you need to configure the following options:

### Details

- Instance Name: the name used by the dashboard to identify the instance

- Flavor: the resources available for the instance. It specifies the number of
 VCPUs, size of the root disk, size of the ephemeral disk and amount of RAM.
 Your allocated flavor (or lesser configurations) can be selected (the
 default is m2.tiny; a 1 VCPU machine)

- Instance Count: number of instance to launch (the default is 1)

- Instance Boot Source: the media used to boot the instance. You can boot from
 image, snapshot and volume (the default is boot from image)

  - Boot from image: Boot instance using an image
  - Boot from snapshot: Boot instance using a snapshot
  - Boot from volume: Boot instance from volume storage

- Image Name: the name of an Image. This option is used when the Instance Boot
 Source is 'Boot from image'

#### Access & Security

- Key Pair: the public/private keys used to log into the instance. See above to
 see how to create them. NOTE: This can't be added or changed after the instance is
 created.

- Security Groups: add network access to your instances. This determines what
 services can be accessed on the instance. You must select 'SSH' Security Groups
 to allow you to login via SSH. If 'SSH' Security Groups is not available, you
 can create it by going to the Access & Security tab on the right-hand side of the
 Cloud Dashboard. The default Security Group (no network access at first) is
 pre-selected.

#### To create a Security Group <a name="SecurityGroup"></a>

1. Login to the [Cloud Dashboard][dashboard]
1. Go to the Access & Security tab
1. Click the 'Create Security Group' button
1. Give a name for the Security Group
1. Give a meaningful description for the Security Group
1. Click the  'Create Security Group' button

The newly-created Security Group has no rules added (no network access defined).
**To add rules to a Security Group:**

1. Go to the Access & Security tab
1. Tick to select the Security Group to add rules
1. Click the 'Manage Rules' button
1. Click the 'Add Rule' button
1. Select what type of Rule you want to create
1. Select from 'Open Port' the 'Port' option to open one single port, or 'Port Range'
 to open a range of ports
1. The 'Remote' option specifies the source of the traffic to be allowed via this
 rule. You may do so either in the form of an IP address block (CIDR) or via a
 source group (Security Group).
1. Click the 'Add' button

You can also click 'Delete Rule' button to delete a rule.

### Availability Zone

Select the Availability Zone for your instance. The Availability Zone is the
location for your instance. By default, the system will select an available
location for you. You can also click the 'Advanced' button to select from a
complete list of available Availability Zones.

### Post-Creation

You can execute a customisation script after you launch your instance. You can
do any initialisation and customisation to your instance by using this script, and it
is executed only once at the first boot of your instance. You can copy/paste
your script by selecting 'Direct Input' or you can upload a script file. The
script can be a shell script or Cloud-init script.

### Advanced Options

You can choose whether you automatically or manually create the disk partition.
In most cases, you shouldn't change the default.

Notes: The above configuration options can be set in the 'Launch Instance' popup
window. To launch the popup window, you can go to the Instances tab and
click tâ€™he Launch Instance' button.

To get more information about the terms used, please refer to
the Glossary.

---

## Example Launch of an Instance <a name="Example"></a>

![`launch`](images/launch_instance.png)

1. Login to the [Cloud Dashboard][dashboard]
1. Go to Dashboard Instances tab
1. Click the 'Launch Instance' button
1. Type the instance name
1. Select a flavor. Flavor indicates the specification of a instance. You can find more information in the Flavor Details.
1. Select one of the NeCTAR official images (we suggest selecting an Ubuntu image such as NeCTAR Ubuntu 14.04 (Trusty) amd64)
 
  ![`image`](images/image_name.png)

1. Click the Access & Security tab
1. Select a key pair that was created earlier
1. Select the security groups to use. Tick 'ssh' and 'http' (these are pre-defined groups in the default personal project).
 
  ![`image`](images/security.png)

1. Click Availability Zone
1. Select the location of your instance or leave as unselected (the system will auto-select an available location)
1. Click the launch button, and the page will change to the Instances Tab
1. After a while (usually a couple of minutes), your instance will become active
 and will have an IP address. The IP address is available in the Instances table
 on your Nectar Dashboard.

The launch button begins Cloud provisioning and initialisation of a running
instance from the selected image and your configuration options. The instance
will normally pass from status "Build" to "Active". Depending on your image
size and cloud activity, the length of time required may vary. Your instance
will have a public IP address and be reachable according to the
Security Groups selected.

Instructions to access the instance are on the 'Accessing Instancesâ€™ page in Cloud Basics.

## If Launch is Unsuccessful

You may get a message that your quota has been exceeded or you have
insufficient resources. Check the table to the right on the Launch Instance page
for the number of instances you may run simultaneously, then check the
Instances tab to see how many Instances you already have running. You may have
to terminate a running Instance to free resources before you can launch another Instance
(see the Instance tab in order to Terminate). If you need more resources, see the allocation
tab to apply for an increase.

If the above doesn't apply to you, alternatively, you can send an email to the
Cloud Help Desk. Please find information on how to lodge a support ticket at
[Nectar Support][nectar support].

[dashboard]: https://dashboard.rc.nectar.org.au
[putty]: http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html
[image]: https://wiki.rc.nectar.org.au/wiki/Image_Catalog
[openstack image]: http://docs.openstack.org/image-guide/content/ch_creating_images_manually.html
[nectar support]: https://support.rc.nectar.org.au/docs/support
[SSH tutorial]: http://training.nectar.org.au/package07/sections/createSSHKey.html
[codecademy bash]: https://www.codecademy.com/learn/learn-the-command-line
